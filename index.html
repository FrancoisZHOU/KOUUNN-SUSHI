<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <!-- ÈÄÇÈÖç iPhone ÂàòÊµ∑Â±èÂíåÂ∫ïÈÉ®Ê®™Êù° -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KOUUNN SUSHI : Le Challenge</title>
    <style>
        /* --- Âü∫Á°ÄÂ∏ÉÂ±Ä --- */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #2c3e50;
            color: white;
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- È°∂ÈÉ® --- */
        header {
            background-color: #e67e22;
            padding: 10px 15px;
            padding-top: calc(10px + env(safe-area-inset-top)); 
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 10;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Logo Ê†∑Âºè */
        .logo-img {
            width: 45px;
            height: 45px;
            object-fit: contain;
            background: white;
            border-radius: 50%;
            border: 2px solid white;
        }

        .header-text h1 {
            margin: 0;
            font-size: 16px;
            font-weight: 800;
            letter-spacing: 1px;
            line-height: 1.2;
        }

        .reputation-stars {
            color: gold;
            letter-spacing: 2px;
            font-size: 12px;
        }
        
        .clock-box {
            background: #fff; 
            color: #333; 
            padding: 8px 12px;
            border-radius: 8px; 
            font-weight: 800; 
            font-family: monospace;
            font-size: 20px;
            border: 3px solid #333;
            transition: background-color 0.5s, color 0.5s;
            min-width: 70px;
            text-align: center;
        }

        /* --- Ê∏∏Êàè‰∏ªÂå∫Âüü --- */
        #game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            overflow: hidden;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
            position: relative;
        }

        .queue-header {
            display: flex;
            justify-content: space-between;
            color: #bdc3c7;
            font-size: 12px;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        /* --- ËÆ¢ÂçïÂàóË°® --- */
        #order-list {
            flex: 1;
            overflow-y: auto;
            background: #34495e;
            border-radius: 8px;
            padding: 8px;
            border: 2px solid #7f8c8d;
            scrollbar-width: thin;
            padding-bottom: 20px; 
        }

        .order-card {
            background: white;
            color: #333;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-left: 6px solid #bdc3c7;
            position: relative;
            transition: transform 0.1s;
        }

        .order-card.active {
            background-color: #fff3e0;
            border: 2px solid #e67e22;
            transform: translateX(5px);
        }
        
        .type-web { border-left-color: #3498db; }
        .type-phone { border-left-color: #9b59b6; }
        .type-urgent { border-left-color: #e74c3c; }
        .type-uber { border-left-color: #27ae60; }

        .order-detail {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .order-top {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 15px;
        }

        .patience-bar-bg {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin-top: 6px;
            width: 100%;
        }

        .patience-bar-fill {
            height: 100%;
            background: #2ecc71;
            border-radius: 4px;
            transition: width 0.1s linear;
        }

        /* --- Â∫ïÈÉ®Âé®Êàø --- */
        #kitchen-area {
            flex-shrink: 0;
            background: #222; 
            border-radius: 12px 12px 0 0;
            padding: 10px 15px;
            /* Â∫ïÈÉ®ÂÆâÂÖ®Ë∑ùÁ¶ª */
            padding-bottom: calc(20px + env(safe-area-inset-bottom)); 
            border-top: 4px solid #e67e22;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            z-index: 20;
        }

        .chef-stage {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
            margin-bottom: 5px;
            position: relative;
        }

        .boss-icon { font-size: 45px; transition: transform 0.1s; }
        .knife-icon { font-size: 30px; position: absolute; right: -20px; top: 0; opacity: 0; }
        .cutting .knife-icon { opacity: 1; animation: chop 0.2s infinite alternate; }
        .cutting .boss-icon { transform: scale(0.95); }
        @keyframes chop { from { transform: rotate(0deg) translateY(0); } to { transform: rotate(-30deg) translateY(10px); } }

        #action-btn {
            width: 100%;
            height: 60px;
            border: none;
            border-radius: 35px;
            background-color: #7f8c8d;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px #555;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            touch-action: manipulation;
        }

        #action-btn.ready { background-color: #e67e22; box-shadow: 0 4px #d35400; }
        #action-btn.ready:active { transform: translateY(2px); box-shadow: 0 2px #d35400; }
        
        .btn-progress {
            position: absolute;
            left: 0; top: 0; bottom: 0; width: 0%;
            background: rgba(255,255,255,0.3);
            pointer-events: none;
            transition: width 0.05s linear;
        }

        /* --- ÂºπÁ™ó --- */
        #modal {
            display: flex; 
            position: fixed; 
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2147483647;
            justify-content: center; align-items: center; padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background: white;
            color: #333;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            max-width: 360px;
            width: 100%;
            position: relative;
        }
        
        .btn-start { 
            background: #e67e22;
            color: white;
            border: none;
            padding: 15px 0;
            font-size: 20px;
            border-radius: 30px; 
            margin-top: 15px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            box-shadow: 0 4px #d35400;
            touch-action: manipulation;
        }
        .btn-start:active { transform: translateY(2px); box-shadow: 0 2px #d35400; }
        
        .bowing-icons { font-size: 50px; margin: 10px 0; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .message-box {
            background: #f8f9fa;
            border-left: 4px solid #e67e22;
            padding: 10px;
            text-align: left;
            font-size: 14px;
            color: #555;
            font-style: italic;
            margin-bottom: 10px;
            line-height: 1.4;
        }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <!-- Logo ÂõæÁâáÂºïÁî® -->
        <img src="logo.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
        <div class="header-text">
            <h1>KOUUNN SUSHI</h1>
            <div class="reputation-stars" id="reputation-display">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
    </div>
    <div class="clock-box" id="clock">17:30</div>
</header>

<div id="game-container">
    <div class="queue-header">
        <span>En attente (<span id="order-count">0</span>)</span>
        <span>Score: <span id="score-val">0</span></span>
    </div>
    
    <div id="order-list"></div>

    <div id="kitchen-area">
        <div class="chef-stage" id="chef-stage">
            <div class="boss-icon">üë©‚Äçüç≥</div>
            <div class="knife-icon">üî™</div>
            <div style="position:absolute; left: -50px; font-size: 45px;" id="sushi-visual">üç£</div>
        </div>
        <!-- Êìç‰ΩúÊåâÈíÆ -->
        <button id="action-btn" 
            ontouchstart="startWork(event)" onmousedown="startWork(event)" 
            ontouchend="stopWork(event)" onmouseup="stopWork(event)">
            <div class="btn-progress" id="btn-progress-bar"></div>
            <span id="btn-text">S√âLECTIONNEZ...</span>
        </button>
        <div style="font-size: 11px; color: #888; margin-top: 5px;">Maintenez pour pr√©parer</div>
    </div>
</div>

<div id="modal">
    <div class="modal-content">
        <h2 id="modal-title">üî™ Pr√™t pour le service ?</h2>
        <div id="modal-body">
            <p>Bienvenue chez <b>KOUUNN SUSHI</b> !</p>
            <p>Ce soir, les commandes explosent !</p>
            <ul style="text-align: left; font-size: 14px; padding-left: 20px;">
                <li>üòã <b>Tout le monde a faim</b> : Les clients ont h√¢te de manger !</li>
                <li>üî• <b>18:30</b> : Le Grand Rush arrive !</li>
                <li>‚è±Ô∏è <b>Le temps passe vite</b> : 1 seconde = 1 minute !</li>
            </ul>
            <p>üëâ <b>Conseil :</b> Servez vite ceux qui attendent depuis longtemps !</p>
        </div>
        <!-- ÂºÄÂßãÊåâÈíÆ -->
        <button class="btn-start" onclick="startGame()">OUVRIR LE RESTO</button>
    </div>
</div>

<script>
    // --- Ê∏∏ÊàèÈÖçÁΩÆ ---
    // 18Áßí: 540 ticks
    const TYPES = {
        WEB: { label: 'Site Web', icon: 'üíª', color: 'type-web', time: 540, prep: 30, food: 'üç£' }, 
        PHONE: { label: 'T√©l√©phone', icon: 'üìû', color: 'type-phone', time: 540, prep: 30, food: 'üç±' }, 
        URGENT: { label: 'URGENT', icon: '‚ö°', color: 'type-urgent', time: 300, prep: 30, food: 'üçô' }, 
        UBER: { label: 'Uber Eats', icon: 'üö≤', color: 'type-uber', time: 540, prep: 30, food: 'ü•°' } 
    };

    // ÂÖ®Â±ÄÂèòÈáè
    let orders = [];
    let score = 0;
    let reputation = 5;
    let gameActive = false;
    let gameTimeMin = 1050; // 17:30
    let timeSpeed = 0;
    
    let activeOrderId = null;
    let workProgress = 0;
    let isWorking = false;
    
    let gameLoopId;
    let spawnTimeout;

    // Èü≥ÊïàÁ≥ªÁªü
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx;
    
    try {
        audioCtx = new AudioContext();
    } catch(e) {
        console.log("Audio not supported");
    }
    
    // ÁªìÊùüÈü≥‰πêÂä†ËΩΩ
    let endMusic = new Audio('end.mp3');
    endMusic.loop = false; // ‰∏çÂæ™ÁéØÊí≠Êîæ

    // ÂÖ≥ÈîÆ‰øÆÂ§çÔºöÈùôÈü≥Ëß£ÈîÅÊ≥ï
    function unlockAudio() {
        // 1. Ëß£ÈîÅ Web Audio
        if (audioCtx && audioCtx.state === 'suspended') {
            audioCtx.resume().catch(e => {});
        }
        
        // 2. Ëß£ÈîÅ HTML5 Audio (End Music)
        // ÂÖàÊääÈü≥ÈáèËÆæ‰∏∫0 (ÈùôÈü≥)
        endMusic.volume = 0;
        
        // Êí≠Êîæ‰∏Ä‰∏ã
        let promise = endMusic.play();
        
        if (promise !== undefined) {
            promise.then(_ => {
                // ÊàêÂäüÊí≠ÊîæÂêéÔºåÁ´ãÂàªÊöÇÂÅú
                endMusic.pause();
                // ËøõÂ∫¶Êù°ÂΩíÈõ∂
                endMusic.currentTime = 0;
                // ÊääÈü≥ÈáèÊÅ¢Â§çÔºå‰∏∫Ê∏∏ÊàèÁªìÊùüÂÅöÂáÜÂ§á
                endMusic.volume = 1.0; 
            }).catch(error => {
                console.log("Audio autoplay prevented");
            });
        }
    }

    // Êí≠ÊîæÁü≠Èü≥Êïà
    function playSound(type) {
        if (!audioCtx) return;
        if (audioCtx.state === 'suspended') audioCtx.resume().catch(e=>{});

        try {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'chop') {
                osc.type = 'square'; osc.frequency.setValueAtTime(150, now);
                gain.gain.setValueAtTime(0.1, now); osc.start(now); osc.stop(now+0.05);
            } else if (type === 'new') {
                osc.frequency.setValueAtTime(600, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.3);
                osc.start(now); osc.stop(now+0.3);
            } else if (type === 'done') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(500, now); osc.frequency.linearRampToValueAtTime(1000, now+0.1);
                gain.gain.setValueAtTime(0.1, now); osc.start(now); osc.stop(now+0.2);
            } else if (type === 'fail') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, now); osc.frequency.linearRampToValueAtTime(50, now+0.3);
                gain.gain.setValueAtTime(0.1, now); osc.start(now); osc.stop(now+0.3);
            }
        } catch (e) {}
    }

    // --- Ê†∏ÂøÉÈÄªËæëÔºöÂºÄÂßãÊ∏∏Êàè ---
    function startGame() {
        // ÂÖ≥ÈîÆÔºöÂú®ËøôÈáåË∞ÉÁî®ÈùôÈü≥Ëß£ÈîÅ
        unlockAudio();

        document.getElementById('modal').style.display = 'none';
        
        // ÈáçÁΩÆÊ∏∏ÊàèÊï∞ÊçÆ
        orders = []; 
        score = 0; 
        reputation = 5; 
        gameTimeMin = 1050; // 17:30
        gameActive = true; 
        activeOrderId = null; 
        resetWork();
        
        // Âà∑Êñ∞ÁïåÈù¢
        updateUI(); 
        updateClock(); 
        renderOrders();
        
        // ÂàùÂßãÁîüÊàê
        spawnOrder(); 

        // Ê∏ÖÁêÜÂπ∂ÂêØÂä®Âæ™ÁéØ
        if (gameLoopId) clearInterval(gameLoopId);
        clearTimeout(spawnTimeout);

        gameLoopId = setInterval(loop, 100); // 0.1ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
        scheduleNextSpawn();
    }

    // --- Ê∏∏Êàè‰∏ªÂæ™ÁéØ ---
    function loop() {
        if (!gameActive) return;

        // 1. Êó∂Èó¥ÊµÅÈÄü (1Áßí = 10 ticks = 1ÂàÜÈíü)
        timeSpeed++;
        if (timeSpeed >= 10) { 
            gameTimeMin++;
            timeSpeed = 0;
            updateClock();
        }

        // 2. ËÄêÂøÉÊµÅÂ§± (3ÁÇπ/tick)
        let failed = false;
        orders.forEach(o => {
            o.patience -= 3; 
            if (o.patience <= 0) {
                failed = true; reputation--; playSound('fail');
            }
        });

        if (failed) {
            orders = orders.filter(o => o.patience > 0);
            if (!orders.find(o => o.id === activeOrderId)) resetWork();
            updateUI(); renderOrders();
            if (reputation <= 0) endGame();
        }

        // 3. Â∑•‰ΩúËøõÂ∫¶Â§ÑÁêÜ
        if (isWorking && activeOrderId !== null) {
            const order = orders.find(o => o.id === activeOrderId);
            if (order) {
                workProgress++;
                playSound('chop');
                if (workProgress % 5 === 0) {
                    document.querySelector('.boss-icon').style.transform = `scale(${Math.random()*0.1+0.9})`;
                }
                let pct = (workProgress / order.prepNeeded) * 100;
                document.getElementById('btn-progress-bar').style.width = pct + '%';

                if (workProgress >= order.prepNeeded) completeOrder(order);
            }
        }
        
        // 4. Êõ¥Êñ∞ËÄêÂøÉÊù°UI
        orders.forEach(o => {
            const bar = document.getElementById(`bar-${o.id}`);
            if (bar) {
                let pct = (o.patience / o.maxPatience) * 100;
                bar.style.width = pct + '%';
                if (pct < 30) bar.style.backgroundColor = '#e74c3c'; 
            }
        });
    }

    // --- ÁîüÊàêËÆ¢ÂçïÈÄªËæë ---
    function scheduleNextSpawn() {
        if (!gameActive) return;
        
        let delay = 4000; 

        if (gameTimeMin < 1050) {
            delay = 4000;
        } else if (gameTimeMin >= 1050 && gameTimeMin < 1110) {
            // 17:30 - 18:30 Âä†ÈÄü
            let progress = (gameTimeMin - 1050) / 60; 
            delay = 4000 - (3000 * progress);
        } else if (gameTimeMin >= 1110 && gameTimeMin < 1170) {
            // 18:30 - 19:30 ÊûÅÈÄü
            delay = 1000; 
        } else if (gameTimeMin >= 1170) {
            delay = 2600;
        }
        
        delay = delay * (0.8 + Math.random() * 0.4);
        
        clearTimeout(spawnTimeout);
        spawnTimeout = setTimeout(() => { spawnOrder(); scheduleNextSpawn(); }, delay);
    }

    function spawnOrder() {
        if (!gameActive) return;
        
        let rand = Math.random();
        let typeKey = 'WEB'; 
        let isRush = (gameTimeMin >= 1110 && gameTimeMin < 1170);

        if (isRush) {
            if (rand < 0.40) typeKey = 'URGENT';
            else if (rand < 0.60) typeKey = 'UBER';
            else if (rand < 0.80) typeKey = 'PHONE';
            else typeKey = 'WEB';
        } else {
            if (rand < 0.20) typeKey = 'URGENT';
            else if (rand < 0.40) typeKey = 'UBER';
            else if (rand < 0.70) typeKey = 'PHONE';
            else typeKey = 'WEB';
        }

        const t = TYPES[typeKey];
        const newOrder = {
            id: Date.now() + Math.random(),
            typeKey: typeKey, ...t,
            maxPatience: t.time, patience: t.time, prepNeeded: t.prep
        };
        
        orders.push(newOrder);
        playSound('new');
        renderOrders();
        if (activeOrderId === null) selectOrder(newOrder.id);
    }

    // --- Êó∂Èíü‰∏éÈ¢úËâ≤ ---
    function updateClock() {
        let h = Math.floor(gameTimeMin / 60);
        let m = gameTimeMin % 60;
        let timeStr = `${h}:${m < 10 ? '0'+m : m}`;
        let clockEl = document.getElementById('clock');
        clockEl.innerText = timeStr;
        
        let r = 255, g = 255, b = 255; 
        if (gameTimeMin >= 1050 && gameTimeMin < 1110) {
            let progress = (gameTimeMin - 1050) / 60; 
            g = 255 - (179 * progress); b = 255 - (195 * progress); r = 255 - (24 * progress);
            clockEl.style.color = progress > 0.5 ? 'white' : '#333';
        } else if (gameTimeMin >= 1110 && gameTimeMin < 1170) {
            r = 231; g = 76; b = 60; clockEl.style.color = 'white';
        } else if (gameTimeMin >= 1170 && gameTimeMin < 1230) {
            let progress = (gameTimeMin - 1170) / 60;
            g = 76 + (179 * progress); b = 60 + (195 * progress); r = 231 + (24 * progress);
            clockEl.style.color = progress < 0.5 ? 'white' : '#333';
        }
        clockEl.style.backgroundColor = `rgb(${r},${g},${b})`;
        
        if (gameTimeMin >= 1260) winGame();
    }

    // --- Áé©ÂÆ∂‰∫§‰∫í ---
    function selectOrder(id) {
        if (activeOrderId === id) return;
        activeOrderId = id;
        resetWork(); renderOrders(); updateButtonState();
    }

    function startWork(e) { 
        if(e && e.cancelable) e.preventDefault(); 
        if(!activeOrderId) return; 
        isWorking = true; 
        document.getElementById('chef-stage').classList.add('cutting'); 
    }
    
    function stopWork(e) { 
        if(e && e.cancelable) e.preventDefault(); 
        isWorking = false; 
        document.getElementById('chef-stage').classList.remove('cutting'); 
        document.querySelector('.boss-icon').style.transform = 'scale(1)'; 
    }
    
    function resetWork() { 
        workProgress = 0; 
        isWorking = false; 
        document.getElementById('chef-stage').classList.remove('cutting'); 
        document.getElementById('btn-progress-bar').style.width = '0%'; 
        updateButtonState(); 
    }

    function completeOrder(order) {
        score++; playSound('done'); resetWork();
        orders = orders.filter(o => o.id !== order.id);
        activeOrderId = null;
        if (orders.length > 0) {
            let mostUrgent = [...orders].sort((a,b) => a.patience - b.patience)[0];
            selectOrder(mostUrgent.id);
        }
        updateUI(); renderOrders();
    }

    // --- Ê∏≤Êüì‰∏éÊõ¥Êñ∞ ---
    function renderOrders() {
        const list = document.getElementById('order-list');
        list.innerHTML = '';
        orders.forEach(o => {
            const el = document.createElement('div');
            el.className = `order-card ${o.color} ${o.id === activeOrderId ? 'active' : ''}`;
            el.onclick = () => selectOrder(o.id);
            el.innerHTML = `
                <div style="font-size: 24px; margin-right: 10px;">${o.icon}</div>
                <div class="order-detail">
                    <div class="order-top"><span>${o.label}</span><span style="font-size:12px; color:#777;">${Math.ceil(o.patience/30)}s</span></div>
                    <div class="patience-bar-bg"><div id="bar-${o.id}" class="patience-bar-fill" style="width: ${(o.patience/o.maxPatience)*100}%"></div></div>
                </div>`;
            list.appendChild(el);
        });
        document.getElementById('order-count').innerText = orders.length;
    }

    function updateButtonState() {
        const btn = document.getElementById('action-btn');
        const btnText = document.getElementById('btn-text');
        const sushiVis = document.getElementById('sushi-visual');
        if (activeOrderId) {
            const order = orders.find(o => o.id === activeOrderId);
            if (order) {
                btn.className = 'ready'; btnText.innerText = `PR√âPARER ${order.label}`; sushiVis.innerText = order.food;
            }
        } else {
            btn.className = ''; btnText.innerText = "S√âLECTIONNEZ UNE COMMANDE"; sushiVis.innerText = '';
        }
    }

    function updateUI() {
        document.getElementById('score-val').innerText = score;
        document.getElementById('reputation-display').innerText = '‚≠ê'.repeat(Math.max(0, reputation));
    }

    // --- ÁªìÊùüÈÄªËæë ---
    function endGame() {
        gameActive = false; 
        clearInterval(gameLoopId); 
        clearTimeout(spawnTimeout);
        
        // Êí≠ÊîæÁªìÊùüÈü≥‰πê (Âõ†‰∏∫Â∑≤ÁªèÂú®startGameÈáåÈùôÈü≥Ëß£ÈîÅËøáÔºåËøôÈáåÂèØ‰ª•ÊîæÂøÉÊí≠Êîæ)
        endMusic.volume = 1.0; // Á°Æ‰øùÈü≥ÈáèÂõûÊù•
        endMusic.play().catch(e => console.log("Music failed", e));

        showModal("C'est la panique ! ü§Ø", `
            <div class="bowing-icons">üôá‚Äç‚ôÇÔ∏èüôá‚Äç‚ôÄÔ∏è</div>
            <div class="message-box">
                "Nous sommes d√©sol√©s pour l'attente aujourd'hui. <br><br>
                G√©rer les commandes Web, le t√©l√©phone et les livraisons en m√™me temps, c'est un vrai sport ! <br><br>
                Merci de votre soutien, nous faisons de notre mieux !"
            </div>
            <p>Commandes servies : <b>${score}</b></p>
        `, "R√©essayer");
    }

    function winGame() {
        gameActive = false; 
        clearInterval(gameLoopId); 
        clearTimeout(spawnTimeout);
        
        endMusic.volume = 1.0;
        endMusic.play().catch(e => console.log("Music failed", e));

        showModal("Service Termin√© ! üéâ", `
            <div class="bowing-icons">üôá‚Äç‚ôÇÔ∏èüôá‚Äç‚ôÄÔ∏è</div>
            <div class="message-box">
                "Merci d'avoir jou√© et merci pour votre fid√©lit√© chez <b>KOUUNN SUSHI</b> ! <br><br>
                M√™me quand c'est le rush, savoir que vous appr√©ciez nos sushis nous donne la force de continuer. <br><br>
                √Ä tr√®s bient√¥t au restaurant !"
            </div>
            <p>Score Final : <b>${score}</b></p>
        `, "Rejouer demain");
    }

    function showModal(title, bodyHTML, btnText) {
        document.getElementById('modal').style.display = 'flex';
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-body').innerHTML = bodyHTML;
        document.querySelector('.btn-start').innerText = btnText;
    }
</script>
</body>
</html>
